# Master Implementation Plan

## Overview

This plan consolidates changes across three interconnected macOS workspace applications:

| Application | Changes Required | Scope |
|-------------|------------------|-------|
| **Aerospace** | 1 comment fix | Documentation only |
| **Borders** | None | No modifications |
| **Sketchybar** | 8 file modifications | Bug fixes + code quality |

**Total files to modify**: 8

## Integration Analysis

### Integration Architecture

```
aerospace.toml
    |
    +-- startup: launches sketchybar
    +-- startup: launches borders
    |
sketchybar <----> aerospace.sh plugin (queries workspace state)
    |
borders (independent - responds to window focus events)
```

### Cross-App Dependencies Verified

1. **Aerospace startup commands** - No changes proposed to `after-startup-command` that launches sketchybar and borders. Integration preserved.

2. **Sketchybar aerospace plugin** - The `plugins/aerospace.sh` file is not modified in this plan. Workspace integration remains intact.

3. **Theme consistency** - The aerospace plan acknowledges that inline border colors (orange/dark) intentionally differ from bordersrc's Tokyo Night theme. This is documented user preference, not a conflict.

4. **Borders configuration** - Fully verified as correct. No changes needed.

### Potential Conflicts

**None identified.** All changes are isolated:
- Aerospace: Comment-only change (no functional impact)
- Borders: No changes
- Sketchybar: Internal bug fixes and documentation cleanup (no aerospace/borders interaction)

## Implementation Order

Recommended sequence to minimize risk and validate incrementally:

### Phase 1: Aerospace (Low Risk)
1. Update workspace-to-monitor comment in `aerospace.toml`
2. **Validation**: Visual inspection only (no functional change)

### Phase 2: Sketchybar Bug Fixes (Critical)
3. Fix `network_speed.sh` timing calculation (divisor 2 -> 5)
4. Fix `network_speed.sh` race condition (separate cache files)
5. **Validation**: Compare speed readings against actual bandwidth test

### Phase 3: Sketchybar Code Quality
6. Update `battery.sh` to use icon variable
7. Update misleading color comments in 6 item files
8. **Validation**: Visual inspection of battery icon, sketchybar reload

### Phase 4: Reload Services
9. Reload sketchybar: `sketchybar --reload`
10. No aerospace/borders restart required

## Changes by File

### aerospace

**File: `/Users/teazyou/workspace/app.configs/aerospace/aerospace.toml`**

| Line | Change Type | Description |
|------|-------------|-------------|
| 63-64 | Comment fix | Update workspace-monitor assignment comment |

**Current:**
```toml
# Assign workspaces to specific monitors
# Workspaces 1, 2, 3 -> Main monitor
# Workspaces 4, 5 -> Secondary monitor
```

**Updated:**
```toml
# Assign workspaces to specific monitors
# Workspaces 1, 2, 3, 4 -> Main monitor
# Workspaces 5, 6 -> Secondary monitor
```

---

### borders

**No changes required.**

The JankyBorders configuration has been verified as correct:
- Valid Tokyo Night theme colors
- Correct option syntax
- Accurate documentation in guide.files.md

---

### sketchybar

#### Critical Bug Fixes

**File: `/Users/teazyou/workspace/app.configs/sketchybar/plugins/network_speed.sh`**

| Line | Change Type | Description |
|------|-------------|-------------|
| 59 | Bug fix | Change `/ 2` to `/ 5` (match update_freq) |
| 60 | Bug fix | Change `/ 2` to `/ 5` (match update_freq) |
| Cache logic | Bug fix | Use separate cache files for upload/download directions |

**Issue**: Network speed readings are 2.5x higher than actual values due to timing mismatch.

**Issue**: Race condition when both network_up and network_down call the script, sharing the same cache file.

#### Code Quality Fixes

**File: `/Users/teazyou/workspace/app.configs/sketchybar/items/battery.sh`**

| Line | Change Type | Description |
|------|-------------|-------------|
| 5 | Improvement | Replace raw icon character with `$BATTERY_100` variable |

**File: `/Users/teazyou/workspace/app.configs/sketchybar/items/volume.sh`**

| Line | Change Type | Description |
|------|-------------|-------------|
| 3 | Comment fix | Change "yellow accent" to "pink accent" or remove |

**File: `/Users/teazyou/workspace/app.configs/sketchybar/items/cpu.sh`**

| Line | Change Type | Description |
|------|-------------|-------------|
| 3 | Comment fix | Change "magenta accent" to "pink accent" or remove |

**File: `/Users/teazyou/workspace/app.configs/sketchybar/items/wifi.sh`**

| Line | Change Type | Description |
|------|-------------|-------------|
| 3 | Comment fix | Change "blue accent" to "pink accent" or remove |

**File: `/Users/teazyou/workspace/app.configs/sketchybar/items/ram.sh`**

| Line | Change Type | Description |
|------|-------------|-------------|
| 3 | Comment fix | Change "orange accent" to "pink accent" or remove |

**File: `/Users/teazyou/workspace/app.configs/sketchybar/items/network_up.sh`**

| Line | Change Type | Description |
|------|-------------|-------------|
| 3 | Comment fix | Change "green accent" to "pink accent" or remove |

**File: `/Users/teazyou/workspace/app.configs/sketchybar/items/network_down.sh`**

| Line | Change Type | Description |
|------|-------------|-------------|
| 3 | Comment fix | Change "blue accent" to "pink accent" or remove |

## Risk Assessment

| Risk Level | Files | Impact |
|------------|-------|--------|
| **None** | aerospace.toml | Comment-only, no functional change |
| **Low** | battery.sh, 6 item comment files | Semantic/documentation improvements |
| **Medium** | network_speed.sh | Speed readings will show ~60% lower (correct) values |

### Mitigation Strategy

For the network speed fix:
1. Test readings against `speedtest-cli` or fast.com before/after
2. Add inline comment explaining divisor matches update_freq
3. Users may perceive "lower" speeds initially - this is the correct behavior

## Testing Checklist

### Aerospace
- [ ] Verify aerospace keybindings still work (alt+hjkl, alt+shift+hjkl, alt+1-9)
- [ ] Verify workspace switching between monitors

### Borders
- [ ] Verify borders appear correctly on focused windows
- [ ] Verify inactive window borders use correct color

### Sketchybar
- [ ] Verify sketchybar displays after reload
- [ ] Verify battery icon displays correctly
- [ ] Verify workspace indicator updates on workspace switch
- [ ] Verify network speed readings are accurate (compare with speedtest)
- [ ] Verify network_up and network_down show independent values

### Integration
- [ ] Restart aerospace and verify sketchybar + borders auto-start
- [ ] Verify sketchybar workspace indicator syncs with aerospace workspace changes
- [ ] Verify all three apps coexist without conflicts

## Summary

This implementation plan addresses:
- **1 documentation fix** in aerospace (comment accuracy)
- **2 critical bugs** in sketchybar (network speed calculation)
- **7 code quality improvements** in sketchybar (comments, icon variable)

All changes are isolated within their respective applications and do not affect the integration points between aerospace, borders, and sketchybar.

---

**Plan consolidated**: 2026-01-08
**Source plans**: 02.borders.plan.md, 02.aerospace.plan.md, 02.sketchybar.plan.md
