# SketchyBar Documentation Report

## Overview

SketchyBar is a highly flexible, customizable, fast, and powerful status bar replacement for macOS. It is designed for users who enjoy tweaking their environment with shell scripts and provides a dynamic, event-driven approach to status bar management.

**Core Design Principle:** All elements of the bar can be added, removed, and freely changed at any point in time. The configuration is not static; instead, SketchyBar provides a powerful event-driven scripting system that allows dynamic adaptation using highly configurable building blocks.

---

## 1. Main Features and Capabilities

### Key Features

- **Dynamic Configuration:** Modify any aspect of the bar on-the-fly via CLI commands. No restart required to see changes.
- **Event-Driven Scripting:** Items can subscribe to system events and run scripts only when relevant changes occur.
- **Powerful Plugins:** Integrate any shell script to display information. Items update on timers or event subscriptions.
- **Popup Menus:** Create on-demand popup menus attached to any bar item.
- **Multiple Configuration Languages:** Supports both shell scripts and Lua (via SbarLua API).
- **Performance-Oriented:** Optimized for minimal system resource impact.

### Special Components

| Component | Description |
|-----------|-------------|
| **Graph** | Displays data visualization as line graphs |
| **Space** | Native integration with macOS Mission Control Spaces |
| **Alias** | Show official macOS menu bar items within SketchyBar |
| **Slider** | Interactive sliders controllable with mouse |
| **Bracket** | Groups multiple items with a common background |

### Typical Use Cases

- Workspace/space indicators
- Active window display
- Date and time
- Network status
- CPU/RAM usage
- Volume and brightness controls
- Battery status
- Media playback information

---

## 2. How It Works (Items, Plugins, Events)

### Items

Items are the basic building blocks of SketchyBar. They are added using:

```bash
sketchybar --add item <name> <position>
```

**Positions:** `left`, `right`, `center`, `q` (left of notch), `e` (right of notch)

**Modifying Properties:**
```bash
sketchybar --set <name> <property>=<value>
```

**Item Management:**
- `--reorder` - Reorder items
- `--move` - Move items before/after reference items
- `--clone` - Clone existing items
- `--rename` - Rename items
- `--remove` - Remove items

### Plugins

Plugins are scripts executed by SketchyBar when items are triggered.

**Default Location:** `~/.config/sketchybar/plugins/`

**Important:** Plugins must be referenced with absolute paths. Relative paths will not resolve correctly.

**Trigger Mechanisms:**
1. **Timer-based:** Using `update_freq` property (polling interval in seconds)
2. **Event-based:** Using `--subscribe` command (event-driven)

**Plugin Purpose:** Call `sketchybar --set` to update item properties (label, icon, etc.)

### Event System

The event system is a cornerstone of SketchyBar's efficiency.

**Subscribing to Events:**
```bash
sketchybar --subscribe <name> <event> [<event2> ...]
```

#### Built-in System Events

| Event | Description |
|-------|-------------|
| `front_app_switched` | Active application changed |
| `space_change` | Mission Control space switched |
| `space_windows_change` | Windows created/destroyed on a space |
| `display_change` | Active display switched |
| `volume_change` | Audio volume adjusted |
| `brightness_change` | Display brightness adjusted |
| `power_source_change` | AC/battery transition |
| `wifi_change` | WiFi connection changed |
| `media_change` | Now-playing media updated |
| `system_will_sleep` | System entering sleep |
| `system_woke` | System woke from sleep |

#### Interaction Events

| Event | Description |
|-------|-------------|
| `mouse.entered` | Mouse entered item area |
| `mouse.exited` | Mouse exited item area |
| `mouse.clicked` | Item clicked (provides button/modifier data) |
| `mouse.scrolled` | Scroll wheel input |

#### Environment Variables in Scripts

| Variable | Description |
|----------|-------------|
| `$NAME` | Name of the item whose script is running |
| `$SENDER` | Name of the event that triggered the script |
| `$INFO` | Event-specific data (e.g., new volume level) |
| `$CONFIG_DIR` | Configuration directory path |
| `$BUTTON` | Click button (left/right/other) |
| `$MODIFIER` | Modifier keys (shift/ctrl/alt/cmd) |
| `$SCROLL_DELTA` | Scroll wheel direction/magnitude |

#### Custom Events

**Creating Custom Events:**
```bash
sketchybar --add event <event_name> [NSDistributedNotificationName]
```

**Triggering Custom Events:**
```bash
sketchybar --trigger <event_name> [VAR=value ...]
```

**NSDistributedNotification Examples:**
- `com.spotify.client.PlaybackStateChanged` - Spotify track change
- `com.apple.screenIsUnlocked` - Screen unlock notification

---

## 3. Configuration Options and Scripting

### Configuration File

**Primary Location:** `~/.config/sketchybar/sketchybarrc`

**Alternative:** Specify custom path with `sketchybar --config <path>`

The configuration file is an executable shell script that runs a series of `sketchybar` commands.

### Configuration Structure

```
~/.config/sketchybar/
├── sketchybarrc          # Main configuration entry point
├── colors.sh             # Color scheme definitions
├── plugins/              # Plugin scripts
│   ├── clock.sh
│   ├── battery.sh
│   └── ...
└── items/                # Item configurations (optional)
```

### Shell Script Configuration

**Setting Defaults:**
```bash
default=(
  icon.font="Hack Nerd Font:Bold:17.0"
  label.font="Hack Nerd Font:Bold:14.0"
  icon.color=0xffffffff
  label.color=0xffffffff
  padding_left=5
  padding_right=5
)
sketchybar --default "${default[@]}"
```

**Adding Items:**
```bash
sketchybar --add item clock right \
           --set clock update_freq=10 \
                       script="~/.config/sketchybar/plugins/clock.sh"
```

### Lua Configuration (SbarLua)

**Setup:**
```lua
package.cpath = package.cpath .. ";/Users/" .. os.getenv("USER") .. "/.local/share/sketchybar_lua/?.so"
local sbar = require("sketchybar")
```

**Key Differences from Shell:**
- Dots become sub-tables: `icon.y_offset=10` becomes `icon = { y_offset = 10 }`
- Use `sbar.exec()` for async command execution (avoid `os.execute` or `io.popen`)

**Async Execution:**
```lua
sbar.exec("sleep 5 && echo TEST", function(result, exit_code)
  print(result)
end)
```

### Global Refresh

```bash
sketchybar --update  # Forces all scripts to execute
```

**Warning:** Never use `--update` within item scripts (causes infinite loops).

---

## 4. AeroSpace Integration

### Overview

AeroSpace uses "workspaces" which are different from macOS "Spaces." By default, SketchyBar won't update when moving windows across AeroSpace workspaces. Integration requires explicit configuration.

### AeroSpace Configuration (~/.aerospace.toml)

**Start SketchyBar with AeroSpace:**
```toml
after-startup-command = ['exec-and-forget sketchybar']
```

**Workspace Change Notification:**
```toml
exec-on-workspace-change = [
  '/bin/bash', '-c',
  'sketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=$AEROSPACE_FOCUSED_WORKSPACE PREV_WORKSPACE=$AEROSPACE_PREV_WORKSPACE'
]
```

**Important:** Add `--focus-follows-window` to workspace change binds to ensure the bar updates when windows are moved.

### SketchyBar Configuration

**Register Custom Event:**
```bash
sketchybar --add event aerospace_workspace_change
```

**Create Workspace Items:**
```bash
WORKSPACES=("1" "2" "3" "4" "5" "6" "7" "8" "9")

for sid in "${WORKSPACES[@]}"; do
  sketchybar --add item space.$sid left \
             --set space.$sid icon=$sid \
                              icon.padding_left=10 \
                              icon.padding_right=10 \
                              background.color=0xff3c3c3c \
                              background.corner_radius=5 \
                              background.height=20 \
                              background.drawing=off \
                              click_script="aerospace workspace $sid" \
                              script="~/.config/sketchybar/plugins/aerospace.sh $sid" \
             --subscribe space.$sid aerospace_workspace_change
done
```

### Plugin Script (~/.config/sketchybar/plugins/aerospace.sh)

```bash
#!/usr/bin/env bash

if [ "$1" = "$FOCUSED_WORKSPACE" ]; then
    sketchybar --set $NAME background.drawing=on
else
    sketchybar --set $NAME background.drawing=off
fi
```

**Make executable:** `chmod +x ~/.config/sketchybar/plugins/aerospace.sh`

### Environment Variables from AeroSpace

| Variable | Description |
|----------|-------------|
| `$AEROSPACE_FOCUSED_WORKSPACE` | Currently focused workspace |
| `$AEROSPACE_PREV_WORKSPACE` | Previously focused workspace |

### Multi-Monitor Considerations

Four different numbering systems exist:
1. AeroSpace monitors (own numbering)
2. SketchyBar monitors
3. AppKit's NSScreen numbering
4. CoreGraphics DirectDisplayID numbering

Some users experience delay between workspace switch and SketchyBar highlight update.

### Active Window Display

**Get Focused Window:**
```bash
aerospace list-windows --focused --format '%{app-name}'
```

**Integration Example:**
```bash
sketchybar --add item window_title center \
           --set window_title script="~/.config/sketchybar/plugins/window_title.sh" \
           --subscribe window_title front_app_switched aerospace_workspace_change
```

---

## 5. Appearance Customization

### Color Format (ARGB)

Colors use 8-digit hex format: `0xAARRGGBB`

| Component | Description |
|-----------|-------------|
| AA | Alpha (transparency) |
| RR | Red channel |
| GG | Green channel |
| BB | Blue channel |

**Examples:**
- `0xffffffff` - Solid white
- `0x00000000` - Fully transparent
- `0x80ff0000` - Semi-transparent red
- `0xff001f30` - Dark teal

**Channel-Specific Modification:**
```bash
sketchybar --set item icon.color.alpha=0.5
```

| Property | Type | Range | Description |
|----------|------|-------|-------------|
| `alpha` | float | 0-1 | Transparency |
| `red` | float | 0-1 | Red channel |
| `green` | float | 0-1 | Green channel |
| `blue` | float | 0-1 | Blue channel |

### Bar Properties

```bash
sketchybar --bar <property>=<value>
```

| Property | Default | Description |
|----------|---------|-------------|
| `color` | `0x44000000` | Background color |
| `border_color` | `0xffff0000` | Border color |
| `border_width` | 0 | Border thickness |
| `corner_radius` | 0 | Rounded corners |
| `height` | 25 | Bar height in pixels |
| `position` | top | `top` or `bottom` |
| `y_offset` | 0 | Vertical adjustment |
| `margin` | 0 | Space around bar perimeter |
| `padding_left` | 0 | Left padding |
| `padding_right` | 0 | Right padding |
| `blur_radius` | 0 | Background blur effect |
| `shadow` | off | Shadow rendering |
| `hidden` | off | Bar visibility |
| `topmost` | off | Layer positioning |
| `sticky` | on | Maintain during space changes |
| `font_smoothing` | off | Font rendering enhancement |
| `notch_width` | 200 | Notch width (MacBook) |
| `display` | all | Which monitor(s) |

### Item Properties

**Geometry:**
- `drawing` - Visibility (on/off)
- `position` - left/right/center/q/e
- `space` / `display` - Which spaces/displays show item
- `y_offset` - Vertical adjustment
- `padding_left` / `padding_right` - Spacing
- `width` - Fixed or dynamic sizing
- `scroll_texts` - Auto-scroll truncated text

**Icon Properties:**
- `icon` - The icon text/symbol
- `icon.font` - Font family, style, size
- `icon.color` - Icon color
- `icon.padding_left` / `icon.padding_right` - Icon spacing
- `icon.y_offset` - Vertical adjustment

**Label Properties:**
- `label` - The label text
- `label.font` - Font family, style, size
- `label.color` - Label color
- `label.padding_left` / `label.padding_right` - Label spacing

**Background Properties:**
- `background.color` - Background color
- `background.border_color` - Border color
- `background.border_width` - Border thickness
- `background.corner_radius` - Rounded corners
- `background.height` - Background height
- `background.drawing` - Enable/disable background
- `background.image` - Background image path

### Font Configuration

**Default Font:** Hack Nerd Font

**Installation:**
```bash
brew install --cask font-hack-nerd-font
```

**Format:** `"Font Name:Style:Size"`

**Example:**
```bash
icon.font="Hack Nerd Font:Bold:17.0"
label.font="SF Pro:Regular:14.0"
```

**SF Symbols:** Install via Homebrew, use the SF Symbols app to find icons, right-click and "Copy Symbol."

**Nerd Font Icons:** Reference the Nerd Font cheat sheet for icon codes.

### Type Reference

| Type | Values |
|------|--------|
| `<boolean>` | `on`, `off`, `yes`, `no`, `true`, `false`, `1`, `0`, `toggle` |
| `<argb_hex>` | 8-digit hex (e.g., `0xffffffff`) |
| `<path>` | Absolute file path |
| `<string>` | Any UTF-8 string or symbol |
| `<float>` | Floating point number |
| `<integer>` | Integer |
| `<positive_integer>` | Positive integer |
| `<positive_integer list>` | Comma-separated positive integers |

---

## 6. Official Documentation Links

### Primary Resources

| Resource | URL |
|----------|-----|
| **Official Documentation** | https://felixkratz.github.io/SketchyBar/ |
| **GitHub Repository** | https://github.com/FelixKratz/SketchyBar |
| **SbarLua (Lua API)** | https://github.com/FelixKratz/SbarLua |

### Documentation Sections

| Section | URL |
|---------|-----|
| Setup & Installation | https://felixkratz.github.io/SketchyBar/setup |
| Bar Properties | https://felixkratz.github.io/SketchyBar/config/bar |
| Item Configuration | https://felixkratz.github.io/SketchyBar/config/items |
| Events & Scripting | https://felixkratz.github.io/SketchyBar/config/events |
| Special Components | https://felixkratz.github.io/SketchyBar/config/components |
| Type Nomenclature | https://felixkratz.github.io/SketchyBar/config/types |
| Tips & Tricks | https://felixkratz.github.io/SketchyBar/config/tricks |

### AeroSpace Integration

| Resource | URL |
|----------|-----|
| **AeroSpace Goodies** | https://nikitabobko.github.io/AeroSpace/goodies |
| **AeroSpace Guide** | https://nikitabobko.github.io/AeroSpace/guide |

### Community Resources

| Resource | URL |
|----------|-----|
| Share Your Setups | https://github.com/FelixKratz/SketchyBar/discussions/47 |
| Share Your Plugins | https://github.com/FelixKratz/SketchyBar/discussions/12 |
| AeroSpace Integration Discussion | https://github.com/FelixKratz/SketchyBar/discussions/598 |

---

## Quick Start Summary

1. **Install:** `brew tap FelixKratz/formulae && brew install sketchybar`
2. **Install Font:** `brew install --cask font-hack-nerd-font`
3. **Copy Config:** Copy example files to `~/.config/sketchybar/`
4. **Make Plugins Executable:** `chmod +x ~/.config/sketchybar/plugins/*`
5. **Hide macOS Menu Bar:** System Settings > Desktop & Dock
6. **Enable Autostart:** `brew services start sketchybar`

**Requirement:** "Displays have separate Spaces" must be enabled in System Settings > Desktop & Dock.
