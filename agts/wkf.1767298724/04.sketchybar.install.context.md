# SketchyBar Installation Guide with AeroSpace Integration

## What is SketchyBar

SketchyBar is a highly customizable macOS status bar replacement. It is a free and open-source project (GPL-3.0) that allows extensive personalization of the macOS menu bar through a powerful, event-driven scripting system.

**Key Features:**
- Complete runtime configurability without restarts
- Built-in animation framework
- Event-driven scripting infrastructure
- Mouse interaction support
- Compatibility with existing macOS menu bar applications
- Graph rendering and pop-up menu generation

**GitHub:** https://github.com/FelixKratz/SketchyBar
**Documentation:** https://felixkratz.github.io/SketchyBar/

---

## Installation (Homebrew)

### Prerequisites

1. **Enable "Displays have separate Spaces"** in macOS System Settings > Desktop & Dock
2. Install a Nerd Font for icons (optional but recommended):
   ```bash
   brew install --cask font-hack-nerd-font
   ```

### Install SketchyBar

```bash
# Add the tap
brew tap FelixKratz/formulae

# Install sketchybar
brew install sketchybar
```

### Create Configuration Directory

```bash
# Create config and plugins directories
mkdir -p ~/.config/sketchybar/plugins

# Copy default configuration (from Homebrew installation)
cp $(brew --prefix)/share/sketchybar/examples/sketchybarrc ~/.config/sketchybar/sketchybarrc
cp $(brew --prefix)/share/sketchybar/examples/plugins/* ~/.config/sketchybar/plugins/

# Make plugins executable
chmod +x ~/.config/sketchybar/plugins/*
```

---

## Service Management

### Start SketchyBar

```bash
# Start as a background service (auto-start on login)
brew services start sketchybar

# Or run directly for debugging (shows output in terminal)
sketchybar
```

### Stop SketchyBar

```bash
# Stop the service
brew services stop sketchybar
```

### Restart SketchyBar

```bash
# Restart the service
brew services restart sketchybar
```

### Check Status

```bash
brew services info sketchybar
```

---

## Minimal Default Configuration

Create/replace `~/.config/sketchybar/sketchybarrc` with this minimal setup:

```bash
#!/bin/bash

# --- Bar Configuration ---
sketchybar --bar \
  height=32 \
  position=top \
  color=0xff1e1e2e \
  border_color=0xff313244 \
  border_width=0 \
  corner_radius=0 \
  padding_left=10 \
  padding_right=10

# --- Default Item Settings ---
sketchybar --default \
  icon.font="Hack Nerd Font:Bold:14.0" \
  icon.color=0xffcdd6f4 \
  label.font="Hack Nerd Font:Bold:14.0" \
  label.color=0xffcdd6f4 \
  padding_left=5 \
  padding_right=5

# --- AeroSpace Workspace Items ---
# Register custom event for AeroSpace
sketchybar --add event aerospace_workspace_change

# Create workspace items for workspaces 1-5
for sid in 1 2 3 4 5; do
  sketchybar --add item space.$sid left \
    --set space.$sid \
      icon="$sid" \
      icon.padding_left=10 \
      icon.padding_right=10 \
      background.color=0xff313244 \
      background.corner_radius=5 \
      background.height=24 \
      background.drawing=off \
      click_script="aerospace workspace $sid" \
      script="$CONFIG_DIR/plugins/aerospace.sh $sid" \
    --subscribe space.$sid aerospace_workspace_change
done

# --- Right Side Items ---
# Clock
sketchybar --add item clock right \
  --set clock \
    update_freq=30 \
    script="$CONFIG_DIR/plugins/clock.sh"

# Battery (optional)
sketchybar --add item battery right \
  --set battery \
    update_freq=120 \
    script="$CONFIG_DIR/plugins/battery.sh"

# Front App
sketchybar --add item front_app left \
  --set front_app \
    icon.drawing=off \
    script="$CONFIG_DIR/plugins/front_app.sh" \
  --subscribe front_app front_app_switched

# --- Initialize ---
sketchybar --update
```

---

## Plugin Scripts

### Workspace Plugin: `~/.config/sketchybar/plugins/aerospace.sh`

```bash
#!/bin/bash

# Highlight the focused workspace
if [ "$1" = "$FOCUSED_WORKSPACE" ]; then
  sketchybar --set $NAME background.drawing=on icon.color=0xff1e1e2e
else
  sketchybar --set $NAME background.drawing=off icon.color=0xffcdd6f4
fi
```

Make it executable:
```bash
chmod +x ~/.config/sketchybar/plugins/aerospace.sh
```

### Clock Plugin: `~/.config/sketchybar/plugins/clock.sh`

```bash
#!/bin/bash

sketchybar --set $NAME label="$(date '+%H:%M')"
```

### Battery Plugin: `~/.config/sketchybar/plugins/battery.sh`

```bash
#!/bin/bash

PERCENTAGE=$(pmset -g batt | grep -Eo "\d+%" | head -1)
sketchybar --set $NAME label="$PERCENTAGE"
```

### Front App Plugin: `~/.config/sketchybar/plugins/front_app.sh`

```bash
#!/bin/bash

sketchybar --set $NAME label="$INFO"
```

Make all plugins executable:
```bash
chmod +x ~/.config/sketchybar/plugins/*.sh
```

---

## AeroSpace Integration

### Add to AeroSpace Config

Add the following to your AeroSpace configuration at `/Users/teazyou/workspace/app.configs/aerospace/aerospace.toml`:

```toml
# Run Sketchybar together with AeroSpace
# sketchybar has built-in detection of already running process,
# so it won't be run twice on AeroSpace restart
after-startup-command = ['exec-and-forget sketchybar']

# Notify Sketchybar about workspace change
exec-on-workspace-change = ['/bin/bash', '-c',
    'sketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=$AEROSPACE_FOCUSED_WORKSPACE'
]
```

### Complete AeroSpace Config Snippet

Based on your current config, add these lines after the `after-startup-command = []` line:

```toml
# Start AeroSpace at login
start-at-login = true

# Run Sketchybar together with AeroSpace
after-startup-command = ['exec-and-forget sketchybar']

# Notify Sketchybar about workspace change
exec-on-workspace-change = ['/bin/bash', '-c',
    'sketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=$AEROSPACE_FOCUSED_WORKSPACE'
]
```

### Environment Variables Available

When `exec-on-workspace-change` triggers, these variables are available:
- `AEROSPACE_FOCUSED_WORKSPACE` - The workspace user switched to
- `AEROSPACE_PREV_WORKSPACE` - The workspace user switched from

---

## How It Works

1. **AeroSpace** triggers `exec-on-workspace-change` whenever you switch workspaces
2. This calls `sketchybar --trigger aerospace_workspace_change` with the focused workspace
3. **SketchyBar** items subscribed to `aerospace_workspace_change` run their scripts
4. The `aerospace.sh` plugin script updates the visual state of workspace indicators

---

## Quick Start Summary

```bash
# 1. Install
brew tap FelixKratz/formulae
brew install sketchybar
brew install --cask font-hack-nerd-font

# 2. Setup config
mkdir -p ~/.config/sketchybar/plugins
# Create sketchybarrc and plugin scripts as shown above

# 3. Make plugins executable
chmod +x ~/.config/sketchybar/plugins/*.sh

# 4. Update AeroSpace config with exec-on-workspace-change

# 5. Start
brew services start sketchybar

# 6. Reload AeroSpace (if already running)
# Press your reload keybind or restart AeroSpace
```

---

## Uninstall

```bash
brew services stop sketchybar
brew uninstall sketchybar
brew untap FelixKratz/formulae
rm -rf ~/.config/sketchybar
```

---

## References

- [SketchyBar GitHub](https://github.com/FelixKratz/SketchyBar)
- [SketchyBar Documentation](https://felixkratz.github.io/SketchyBar/)
- [AeroSpace Goodies - SketchyBar Integration](https://nikitabobko.github.io/AeroSpace/goodies)
- [SketchyBar Discussion #598 - AeroSpace Integration](https://github.com/FelixKratz/SketchyBar/discussions/598)
