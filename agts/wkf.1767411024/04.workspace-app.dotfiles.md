# SketchyBar: Displaying App Names Per Workspace

## Summary

**Is this feature possible?** Yes, it is fully achievable with SketchyBar to display application names or icons next to workspace numbers, creating a display like:
```
[1] Brave Obsidian [2] [3] Code iTerm2
```

## Required Dependencies

### Option 1: AeroSpace (Recommended for Tiling WM Users)
- **AeroSpace**: A tiling window manager for macOS
- **SketchyBar**: Status bar for macOS
- **jq**: JSON processor for parsing window data
- **sketchybar-app-font** (optional): Custom font with app icons

### Option 2: Yabai
- **Yabai**: Window manager with extensive scripting capabilities
- **SketchyBar**: Status bar for macOS
- **jq**: JSON processor
- **sketchybar-app-font** (optional): Custom font with app icons

### Option 3: Native macOS Spaces (No Tiling WM)
- **SketchyBar**: Uses built-in `space_windows_change` event
- **jq**: JSON processor
- **macOS Ventura or newer**: Required for the `space_windows_change` event

---

## Implementation Methods

### Method 1: Using Native SketchyBar Events (macOS Ventura+)

SketchyBar provides a native `space_windows_change` event that fires when windows change in a space. The event provides an `INFO` variable containing:
```json
{ "space": 1, "apps": { "Brave Browser": 1, "Obsidian": 2 } }
```

#### Configuration

**sketchybarrc** - Add space items with event subscription:
```bash
#!/bin/bash

PLUGIN_DIR="$CONFIG_DIR/plugins"

# Add the space items
SPACE_ICONS=("1" "2" "3" "4" "5" "6" "7" "8" "9")

for i in "${!SPACE_ICONS[@]}"
do
  sid="$(($i+1))"
  sketchybar --add space space.$sid left \
             --set space.$sid space=$sid \
                              icon="${SPACE_ICONS[i]}" \
                              icon.padding_left=10 \
                              icon.padding_right=4 \
                              label.font="sketchybar-app-font:Regular:14.0" \
                              label.padding_right=15 \
                              label.y_offset=-1 \
                              background.color=0x40ffffff \
                              background.corner_radius=5 \
                              background.height=22 \
                              script="$PLUGIN_DIR/space.sh"
done

# Add separator that handles window changes
sketchybar --add item space_separator left \
           --set space_separator icon=">" \
                                 padding_left=10 \
                                 padding_right=10 \
                                 label.drawing=off \
                                 script="$PLUGIN_DIR/space_windows.sh" \
           --subscribe space_separator space_windows_change
```

**plugins/space_windows.sh** - Handle window change events:
```bash
#!/bin/bash

if [ "$SENDER" = "space_windows_change" ]; then
  space="$(echo "$INFO" | jq -r '.space')"
  apps="$(echo "$INFO" | jq -r '.apps | keys[]')"

  icon_strip=""
  if [ "${apps}" != "" ]; then
    while read -r app
    do
      # Option A: Use app names directly
      icon_strip+=" ${app}"

      # Option B: Use icon mapping for symbols
      # icon_strip+=" $($CONFIG_DIR/plugins/icon_map_fn.sh "$app")"
    done <<< "${apps}"
  fi

  sketchybar --set space.$space label="$icon_strip"
fi
```

---

### Method 2: Using AeroSpace Integration

#### aerospace.toml Configuration
```toml
# Start sketchybar with AeroSpace
after-startup-command = ['exec-and-forget sketchybar']

# Notify sketchybar on workspace changes
exec-on-workspace-change = ['/bin/bash', '-c',
  'sketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=$AEROSPACE_FOCUSED_WORKSPACE'
]

# Optional: Notify on focus changes
on-focus-changed = ['exec-and-forget sketchybar --trigger aerospace_focus_change']
```

#### sketchybarrc - AeroSpace Spaces Setup
```bash
#!/bin/bash

CONFIG_DIR="$HOME/.config/sketchybar"
PLUGIN_DIR="$CONFIG_DIR/plugins"

# Add custom event
sketchybar --add event aerospace_workspace_change

# Get all workspaces and create items
workspaces=$(aerospace list-workspaces --all)

for sid in $workspaces; do
  sketchybar --add item space.$sid left \
             --set space.$sid icon="[$sid]" \
                              icon.padding_left=8 \
                              icon.padding_right=4 \
                              label="" \
                              label.font="sketchybar-app-font:Regular:14.0" \
                              label.padding_right=10 \
                              background.color=0x40ffffff \
                              background.corner_radius=5 \
                              background.height=22 \
                              click_script="aerospace workspace $sid" \
                              script="$PLUGIN_DIR/aerospace.sh $sid" \
             --subscribe space.$sid aerospace_workspace_change
done
```

#### plugins/aerospace.sh - Handle Workspace Changes
```bash
#!/bin/bash

WORKSPACE_ID=$1

if [ "$SENDER" = "aerospace_workspace_change" ]; then
  # Get apps in this workspace
  apps=$(aerospace list-windows --workspace "$WORKSPACE_ID" --format '%{app-name}' 2>/dev/null)

  icon_strip=""
  if [ -n "$apps" ]; then
    while IFS= read -r app; do
      if [ -n "$app" ]; then
        # Option A: Use app names
        icon_strip+=" ${app}"

        # Option B: Use icon mapping
        # icon_strip+=" $($CONFIG_DIR/plugins/icon_map_fn.sh "$app")"
      fi
    done <<< "$apps"
  fi

  # Highlight focused workspace
  if [ "$FOCUSED_WORKSPACE" = "$WORKSPACE_ID" ]; then
    sketchybar --set space.$WORKSPACE_ID \
               label="$icon_strip" \
               icon.highlight=on \
               background.border_color=0xffffffff
  else
    sketchybar --set space.$WORKSPACE_ID \
               label="$icon_strip" \
               icon.highlight=off \
               background.border_color=0x00000000
  fi
fi
```

---

### Method 3: Using Yabai Integration

#### yabairc - Configure Signals
```bash
# Trigger sketchybar on window events
yabai -m signal --add event=window_created action="sketchybar --trigger yabai_window_change"
yabai -m signal --add event=window_destroyed action="sketchybar --trigger yabai_window_change"
yabai -m signal --add event=window_moved action="sketchybar --trigger yabai_window_change"
yabai -m signal --add event=space_changed action="sketchybar --trigger yabai_space_change"
```

#### plugins/yabai_spaces.sh - Query Windows Per Space
```bash
#!/bin/bash

SPACE_COUNT=$(yabai -m query --spaces | jq '. | length')

for ((i = 1; i <= SPACE_COUNT; i++)); do
  LABEL=""
  APPS=$(yabai -m query --windows --space $i)
  APPS_LENGTH=$(echo "$APPS" | jq '. | length')

  for ((j = 0; j < APPS_LENGTH; j++)); do
    APP=$(echo "$APPS" | jq ".[$j]")
    APP_NAME=$(echo "$APP" | jq -r '.app')

    # Option A: Use app name
    LABEL+=" $APP_NAME"

    # Option B: Use icon mapping
    # APP_ICON=$($CONFIG_DIR/plugins/icon_map_fn.sh "$APP_NAME")
    # LABEL+="$APP_ICON "
  done

  sketchybar --set space.$i label="$LABEL"
done
```

---

## Icon Mapping (Optional)

For stylized icons instead of text names, install **sketchybar-app-font**:

### Installation
```bash
# Install font
curl -L https://github.com/kvndrsslr/sketchybar-app-font/releases/download/v1.0.16/sketchybar-app-font.ttf \
  -o $HOME/Library/Fonts/sketchybar-app-font.ttf

# Install icon mapping function
curl -L https://github.com/kvndrsslr/sketchybar-app-font/releases/download/v1.0.20/icon_map_fn.sh \
  -o ~/.config/sketchybar/plugins/icon_map_fn.sh

chmod +x ~/.config/sketchybar/plugins/icon_map_fn.sh
```

### Usage in Scripts
```bash
source "$CONFIG_DIR/plugins/icon_map_fn.sh"
__icon_map "Brave Browser"
echo "$icon_result"  # Returns the icon glyph
```

### Label Font Configuration
```bash
sketchybar --set space.$sid label.font="sketchybar-app-font:Regular:14.0"
```

---

## Lua API Example (Advanced)

For better performance, use SketchyBar's Lua API:

**items/spaces.lua**:
```lua
local sbar = require("sketchybar")
local app_icons = require("helpers.app_icons")

-- Create spaces
local spaces = {}
for i = 1, 9 do
  local space = sbar.add("space", "space." .. i, {
    space = i,
    icon = "[" .. i .. "]",
    label = {
      font = { family = "sketchybar-app-font", size = 14.0 },
      string = "",
    },
  })
  spaces[i] = space
end

-- Window observer
local space_window_observer = sbar.add("item", {
  drawing = false,
  updates = true,
})

space_window_observer:subscribe("space_windows_change", function(env)
  local icon_line = ""
  local no_app = true

  for app, count in pairs(env.INFO.apps) do
    no_app = false
    local lookup = app_icons[app]
    local icon = ((lookup == nil) and app_icons["Default"] or lookup)
    icon_line = icon_line .. " " .. (app)  -- Use app name or icon
  end

  if no_app then
    icon_line = ""
  end

  sbar.animate("tanh", 10, function()
    spaces[env.INFO.space]:set({ label = icon_line })
  end)
end)
```

---

## Limitations and Considerations

### Known Limitations

1. **Hidden/Minimized Windows**: macOS does not consistently notify about hidden or minimized windows. Electron apps (Discord, Slack) that hide rather than close may cause display inconsistencies.

2. **AeroSpace Events**: Some window events are missing in AeroSpace, making fully robust real-time updates challenging.

3. **Performance**: Querying all workspaces on every change can be slow. Optimize by only updating the focused and previously focused workspaces.

4. **Multi-Monitor**: Requires additional configuration to show correct workspaces per display.

### Performance Tips

1. **Selective Updates**: Only update affected workspaces:
   ```bash
   # Update only focused and previous workspaces
   sketchybar --trigger aerospace_workspace_change \
     FOCUSED=$AEROSPACE_FOCUSED_WORKSPACE \
     PREV_FOCUSED=$AEROSPACE_PREV_WORKSPACE
   ```

2. **Use Lua API**: The Lua API is faster than shell scripts for complex operations.

3. **Debounce Events**: Add yabai signals with debouncing to prevent excessive updates.

### Alternative Approach: Show Icons Only for Focused Workspace

For better performance, only show apps for the currently focused workspace:
```bash
if [ "$FOCUSED_WORKSPACE" = "$SID" ]; then
  # Show apps
else
  # Clear label
  sketchybar --set space.$SID label=""
fi
```

---

## References

- [SketchyBar Documentation](https://felixkratz.github.io/SketchyBar/)
- [AeroSpace Goodies - SketchyBar Integration](https://nikitabobko.github.io/AeroSpace/goodies)
- [sketchybar-app-font Repository](https://github.com/kvndrsslr/sketchybar-app-font)
- [FelixKratz Dotfiles](https://github.com/FelixKratz/dotfiles)
- [Josean's SketchyBar Setup Guide](https://www.josean.com/posts/sketchybar-setup)
- [xiamaz/sketchybar-aerospace-plugin](https://github.com/xiamaz/sketchybar-aerospace-plugin)
- [Sparkylc2/minimal-aerospace-sketchybar-config](https://github.com/Sparkylc2/minimal-aerospace-sketchybar-config)
